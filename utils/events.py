import locale
import openpyxl
from datetime import datetime

MAX_PARTICIPANTS = 10  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Å—É–º–º—ã –≤ —Ç–µ–∫—Å—Ç
def convert_number_to_text(number):
    # –í—ã–≤–æ–¥–∏–º —Å—É–º–º—É –∫–∞–∫ —Ç–µ–∫—Å—Ç
    locale.setlocale(locale.LC_ALL, 'ru_RU.UTF-8')  # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ª–æ–∫–∞–ª—å –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
    currency_text = locale.currency(number, grouping=True).replace('‚ÇΩ', '')
    # –ó–∞–º–µ–Ω—è–µ–º –Ω–µ—Ä–∞–∑—Ä—ã–≤–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã –Ω–∞ –æ–±—ã—á–Ω—ã–µ
    return currency_text.replace('\xa0', ' ')


# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞ —Å—É–º–º—ã –≤ –Ω—É–∂–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
def process_data(data):

    # –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π
    sum_value = float(data.get("answers_check")['sum'])  # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Å—Ç—Ä–æ–∫—É –≤ —á–∏—Å–ª–æ
    date_str = data.get("answers_check")['date']

    # Q9: –¶–µ–ª–∞—è —á–∞—Å—Ç—å –æ—Ç sum
    Q9 = int(sum_value)  # –¶–µ–ª–∞—è —á–∞—Å—Ç—å —Å—É–º–º—ã
    
    # W9: –ö–æ–ø–µ–π–∫–∏ –æ—Ç sum
    W9 = round(sum_value - Q9, 2) * 100  # –ö–æ–ø–µ–π–∫–∏ (—É–º–Ω–æ–∂–∞–µ–º –Ω–∞ 100 –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —á–∏—Å–ª–∞ —Å –∫–æ–ø–µ–π–∫–∞–º–∏)

    # I13: –î–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ '–î–î.–ú–ú.–ì–ì'
    date_obj = datetime.strptime(date_str, '%Y%m%dT%H%M')
    I13 = date_obj.strftime('%d.%m.%y')  # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –Ω—É–∂–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç

    # I33: –°—É–º–º–∞ (–ø—Ä–æ—Å—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º sum_value)
    I33 = sum_value
    
    # P23: –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–ª–æ–≤–æ "–†–∞—Å—Ö–æ–¥" + –º–µ—Å—è—Ü –∏ –≥–æ–¥
    date_obj_month_year = datetime.strptime(date_str, '%Y%m%dT%H%M')
    # –ü–µ—Ä–µ–≤–æ–¥–∏–º –º–µ—Å—è—Ü –Ω–∞ —Ä—É—Å—Å–∫–∏–π
    P23 = f"–†–∞—Å—Ö–æ–¥ {date_obj_month_year.strftime('%B %Y').capitalize()}"
    # –ü–µ—Ä–µ–≤–æ–¥–∏–º –º–µ—Å—è—Ü –Ω–∞ —Ä—É—Å—Å–∫–∏–π –≤—Ä—É—á–Ω—É—é
    months = {
        'January': '–Ø–Ω–≤–∞—Ä—å', 'February': '–§–µ–≤—Ä–∞–ª—å', 'March': '–ú–∞—Ä—Ç', 'April': '–ê–ø—Ä–µ–ª—å', 
        'May': '–ú–∞–π', 'June': '–ò—é–Ω—å', 'July': '–ò—é–ª—å', 'August': '–ê–≤–≥—É—Å—Ç', 'September': '–°–µ–Ω—Ç—è–±—Ä—å', 
        'October': '–û–∫—Ç—è–±—Ä—å', 'November': '–ù–æ—è–±—Ä—å', 'December': '–î–µ–∫–∞–±—Ä—å'
    }
    P23 = P23.replace(date_obj_month_year.strftime('%B'), months[date_obj_month_year.strftime('%B')])

    # I39: –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Å—É–º–º—É –≤ —Ç–µ–∫—Å—Ç
    rub, kop = divmod(sum_value, 1)  # –†–∞–∑–¥–µ–ª—è–µ–º –Ω–∞ —Ä—É–±–ª–∏ –∏ –∫–æ–ø–µ–π–∫–∏
    kop = round(kop * 100)  # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∫–æ–ø–µ–π–∫–∏ –≤ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ
    # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Å—É–º–º—É –≤ —Ç–µ–∫—Å—Ç
    I39 = f"{convert_number_to_text(rub)} —Ä—É–±–ª–µ–π {kop} –∫–æ–ø–µ–µ–∫ ({int(rub)} —Ä—É–±. {kop} –∫–æ–ø.)"

    # –†–µ–∑—É–ª—å—Ç–∞—Ç –≤ –≤–∏–¥–µ —Å–ª–æ–≤–∞—Ä—è
    return {
        'Q9': Q9,
        'W9': W9,
        'I13': I13,
        'I33': I33,
        'P23': P23,
        'I39': I39
    }


# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ —è—á–µ–π–∫—É Excel –ø–æ —É–∫–∞–∑–∞–Ω–Ω—ã–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º.
def add_data_to_cell(file_path, cell, value):

    # –û—Ç–∫—Ä—ã—Ç–∏–µ –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–∞–±–æ—á–µ–≥–æ —Ñ–∞–π–ª–∞
    workbook = openpyxl.load_workbook(file_path)
    sheet = workbook.active  # –í—ã–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –ª–∏—Å—Ç

    # –ó–∞–ø–∏—Å—å –∑–Ω–∞—á–µ–Ω–∏—è –≤ —É–∫–∞–∑–∞–Ω–Ω—É—é —è—á–µ–π–∫—É
    sheet[cell] = value

    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
    workbook.save(file_path)


questions_event = {
    "event_location": ('–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–∞:\n\nüè¢ –ú–µ—Å—Ç–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è:'),
    "meeting_theme": ("üìù –¢–µ–º–∞ —Å–æ–±—Ä–∞–Ω–∏—è. –í–≤–µ–¥–∏—Ç–µ —Ç–µ–º—É: "),
    "guest_name": ("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –§–ò–û –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞: "),
    "guest_workplace": ("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –º–µ—Å—Ç–æ —Ä–∞–±–æ—Ç—ã –¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–∞: ")
}