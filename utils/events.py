import locale
import openpyxl
from datetime import datetime

MAX_PARTICIPANTS = 10  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Å—É–º–º—ã –≤ —Ç–µ–∫—Å—Ç
def convert_number_to_text(number):

    # –í—ã–≤–æ–¥–∏–º —Å—É–º–º—É –∫–∞–∫ —Ç–µ–∫—Å—Ç
    locale.setlocale(locale.LC_ALL, 'ru_RU.UTF-8')
    currency_text = locale.currency(number, grouping=True).replace('‚ÇΩ', '')
    return currency_text.replace('\xa0', ' ')


# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞ —Å—É–º–º—ã –≤ –Ω—É–∂–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
def process_data(data):

    # –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π
    sum_value = float(data.get("answers_check")['sum']) 
    date_input = data.get("answers_check")['date']

    # Q9: –¶–µ–ª–∞—è —á–∞—Å—Ç—å –æ—Ç sum
    Q9 = int(sum_value) 
    
    # W9: –ö–æ–ø–µ–π–∫–∏ –æ—Ç sum
    W9 = round((sum_value - Q9) * 100)

    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ–æ—Ä–º–∞—Ç –≤—Ö–æ–¥—è—â–µ–π –¥–∞—Ç—ã
    if isinstance(date_input, datetime): 
        date_obj = date_input
    else:
        try:
            date_obj = datetime.strptime(date_input, '%Y%m%dT%H%M') 
        except ValueError:
            date_obj = datetime.strptime(date_input, '%d.%m.%Y %H:%M') 

    # I13: –î–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ '–î–î.–ú–ú.–ì–ì'
    I13 = date_obj.strftime('%d.%m.%y') 

    # I33: –°—É–º–º–∞ (–ø—Ä–æ—Å—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º sum_value)
    I33 = sum_value

    # P23: –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–ª–æ–≤–æ "–†–∞—Å—Ö–æ–¥" + –º–µ—Å—è—Ü –∏ –≥–æ–¥
    months = {
        'January': '–Ø–Ω–≤–∞—Ä—å', 'February': '–§–µ–≤—Ä–∞–ª—å', 'March': '–ú–∞—Ä—Ç', 'April': '–ê–ø—Ä–µ–ª—å', 
        'May': '–ú–∞–π', 'June': '–ò—é–Ω—å', 'July': '–ò—é–ª—å', 'August': '–ê–≤–≥—É—Å—Ç', 'September': '–°–µ–Ω—Ç—è–±—Ä—å', 
        'October': '–û–∫—Ç—è–±—Ä—å', 'November': '–ù–æ—è–±—Ä—å', 'December': '–î–µ–∫–∞–±—Ä—å'
    }

    month_eng = date_obj.strftime('%B')  # –ü–æ–ª—É—á–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –º–µ—Å—è—Ü–∞ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º
    P23 = f"–†–∞—Å—Ö–æ–¥ {months.get(month_eng, month_eng)} {date_obj.strftime('%Y')}"

    # I39: –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Å—É–º–º—É –≤ —Ç–µ–∫—Å—Ç
    rub, kop = divmod(sum_value, 1) 
    kop = round(kop * 100)
    I39 = f"{convert_number_to_text(int(rub))} —Ä—É–±–ª–µ–π {kop} –∫–æ–ø–µ–µ–∫ ({int(rub)} —Ä—É–±. {kop} –∫–æ–ø.)"

    # –†–µ–∑—É–ª—å—Ç–∞—Ç –≤ –≤–∏–¥–µ —Å–ª–æ–≤–∞—Ä—è
    return {
        'Q9': Q9,
        'W9': W9,
        'I13': I13,
        'I33': I33,
        'I35': I33,
        'I39': I39,
        'P23': P23
    }


# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ —è—á–µ–π–∫—É Excel –ø–æ —É–∫–∞–∑–∞–Ω–Ω—ã–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º.
def add_data_to_cell(file_path, cell, value):

    # –û—Ç–∫—Ä—ã—Ç–∏–µ –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–∞–±–æ—á–µ–≥–æ —Ñ–∞–π–ª–∞
    workbook = openpyxl.load_workbook(file_path)
    sheet = workbook.active  # –í—ã–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –ª–∏—Å—Ç

    # –ó–∞–ø–∏—Å—å –∑–Ω–∞—á–µ–Ω–∏—è –≤ —É–∫–∞–∑–∞–Ω–Ω—É—é —è—á–µ–π–∫—É
    sheet[cell] = value

    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
    workbook.save(file_path)


questions_event = {
    "event_location": ('–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–∞:\n\nüè¢ –ú–µ—Å—Ç–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è:'),
    "meeting_theme": ("üìù –¢–µ–º–∞ —Å–æ–±—Ä–∞–Ω–∏—è. –í–≤–µ–¥–∏—Ç–µ —Ç–µ–º—É: "),
    "guest_name": ("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –§–ò–û –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞: "),
    "guest_workplace": ("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –º–µ—Å—Ç–æ —Ä–∞–±–æ—Ç—ã –¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–∞: ")
}